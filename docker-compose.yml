version: '2.1'

services:
    ceph:
        build: ./docker/ceph
        image: ceph-dev
        container_name: ceph
        hostname: ceph
        domainname: dev
        networks:
            default:
                aliases:
                    - 'ceph.dev'
        ports: ['${DASHBOARD_HOST_PORT}:4200']
        volumes:
            - ./docker/ceph:/docker
            - ${CEPH_REPO_DIR}:/ceph
            - ${HOST_CCACHE_DIR}:/root/.ccache
        environment:
            - GRAFANA_HOST_PORT=${GRAFANA_HOST_PORT}
        command: /docker/start.sh

    prometheus:
        image: 'quay.io/prometheus/prometheus'
        container_name: prometheus
        hostname: prometheus
        domainname: dev
        networks:
            default:
                aliases:
                    - 'prometheus.dev'
        ports: ['${PROMETHEUS_HOST_PORT}:9090']
        volumes:
            - ./docker/prometheus:/etc/prometheus:ro

    grafana:
        build: ./docker/grafana
        image: grafana-ceph
        container_name: grafana
        hostname: grafana
        domainname: dev
        networks:
            default:
                aliases:
                    - 'grafana.dev'
        ports: ['${GRAFANA_HOST_PORT}:3000']
        volumes:
            - grafana_data:/var/lib/grafana
            - ./docker/grafana/grafana.ini:/etc/grafana/grafana.ini:ro
            - ./docker/grafana/provisioning:/etc/grafana/provisioning:ro
        depends_on:
            - prometheus

#    luminous:
#        build: ./docker/ceph/luminous
#        image: luminous
#        container_name: luminous
#        hostname: luminous
#        domainname: dev
#        networks:
#            default:
#                aliases:
#                    - 'luminous.dev'
#        ports: ['11000:11000','${DASHBOARD_HOST_PORT}:4200']
#        volumes:
#            - ./docker/ceph:/docker
#            - ${LUMINOUS_REPO_DIR}:/ceph
#        env_file:
#            - .env
#        command: /docker/luminous/start.sh

volumes:
    grafana_data:

networks:
    default:
        driver: bridge
        enable_ipv6: true
        ipam:
            driver: default
            config:
                - subnet: 172.20.0.0/24
                - subnet: 2600:3c02:e000:0058::/64
